# Celery Configuration Environment Variables
# Following Celery 5.5.3 best practices

# Broker and Backend Configuration
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# Worker Configuration
CELERY_WORKER_CONCURRENCY=2
CELERY_WORKER_PREFETCH_MULTIPLIER=1

# Task Configuration
CELERY_TASK_ACKS_LATE=true
CELERY_TASK_REJECT_ON_WORKER_LOST=true
CELERY_TASK_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_RESULT_SERIALIZER=json

# Timezone and UTC
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# Result Backend Configuration
CELERY_RESULT_EXPIRES=3600

# Task Execution Configuration
CELERY_TASK_ALWAYS_EAGER=false
CELERY_TASK_EAGER_PROPAGATES=true

# Monitoring and Logging
CELERY_WORKER_LOG_FORMAT="[%(asctime)s: %(levelname)s/%(processName)s] %(message)s"
CELERY_WORKER_TASK_LOG_FORMAT="[%(asctime)s: %(levelname)s/%(processName)s] [%(task_name)s(%(task_id)s)] %(message)s"

# Development vs Production
CELERY_TASK_ALWAYS_EAGER=false  # Set to true for testing without workers
CELERY_WORKER_CONCURRENCY=2     # Adjust based on server resources
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_WORKER_MAX_MEMORY_PER_CHILD=200000

# Task Limits
CELERY_TASK_TIME_LIMIT=3600
CELERY_TASK_SOFT_TIME_LIMIT=3000
CELERY_TASK_RATE_LIMIT=2/m  # Maximum 2 tasks per minute per worker 